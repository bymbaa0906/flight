import random
import time

class DogAgent:
    def __init__(self, n_rooms, k_lives):
        """
        –ù–æ—Ö–æ–π —Ç—ç–∂—ç—ç—Ö –∞–≥–µ–Ω—Ç—ã–Ω –∞–Ω—Ö–Ω—ã —Ç–æ—Ö–∏—Ä–≥–æ–æ
        
        Parameters:
        n_rooms (int): ”®—Ä”©”©–Ω–∏–π —Ç–æ–æ
        k_lives (int): –ù–æ—Ö–æ–π–Ω—ã –∞–º—å
        """
        self.n_rooms = n_rooms
        self.k_lives = k_lives
        self.current_lives = k_lives
        self.current_room = 0
        self.has_eaten = False
        self.visited_all = False
        self.room_features = []
        self.visited_rooms = []
        self.moves = 0
        
        # ”®—Ä”©”©–Ω“Ø“Ø–¥–∏–π–≥ —Å–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π–≥—ç—ç—Ä —ç—Ö–ª“Ø“Ø–ª—ç—Ö
        self._initialize_rooms()
        
    def _initialize_rooms(self):
        """”®—Ä”©”©–Ω“Ø“Ø–¥–∏–π–≥ —Å–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π –æ–Ω—Ü–ª–æ–≥—É—É–¥—Ç–∞–π–≥–∞–∞—Ä —ç—Ö–ª“Ø“Ø–ª—ç—Ö"""
        features = ['food', 'bed', 'toy', 'empty']
        self.room_features = [random.choice(features) for _ in range(self.n_rooms)]
        
    def _shuffle_rooms(self):
        """–ë“Ø—Ö ”©—Ä”©”©–≥ –∑–æ—Ä—á–∏–∂ –¥—É—É—Å—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ ”©—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—É—É–¥—ã–≥ —Å–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π–≥—ç—ç—Ä ”©”©—Ä—á–ª”©—Ö"""
        features = ['food', 'bed', 'toy', 'empty']
        self.room_features = [random.choice(features) for _ in range(self.n_rooms)]
        print(f"”®—Ä”©”©–Ω“Ø“Ø–¥–∏–π–Ω –æ–Ω—Ü–ª–æ–≥—É—É–¥ —à–∏–Ω—ç—á–ª—ç–≥–¥–ª—ç—ç: {self.room_features}")
        
    def _move_to_next_room(self):
        """–î–∞—Ä–∞–∞–≥–∏–π–Ω ”©—Ä”©”© —Ä“Ø“Ø —à–∏–ª–∂–∏—Ö"""
        # –ó“Ø“Ø–Ω—ç—ç—Å –±–∞—Ä—É—É–Ω —Ç–∏–π—à —à–∏–ª–∂–∏—Ö
        if self.current_room < self.n_rooms - 1:
            self.current_room += 1
            return True
        else:
            # –ë“Ø—Ö ”©—Ä”©”©–≥ –∑–æ—Ä—á–∏–∂ –¥—É—É—Å—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
            if not self.visited_all:
                self.visited_all = True
                print("\n" + "="*50)
                print("–ë“Ø—Ö ”©—Ä”©”©–≥ –∞–º–∂–∏–ª—Ç—Ç–∞–π –∑–æ—Ä—á–∏–ª–æ–æ! ”®—Ä”©”©–Ω“Ø“Ø–¥–∏–π–Ω –æ–Ω—Ü–ª–æ–≥—É—É–¥ —à–∏–Ω—ç—á–ª—ç–≥–¥—ç–∂ –±–∞–π–Ω–∞...")
                print("="*50)
                self._shuffle_rooms()
                self.current_room = 0  # –≠—Ö–Ω–∏–π ”©—Ä”©”© —Ä“Ø“Ø –±—É—Ü–∞—Ö
                return True
            else:
                # –ë“Ø—Ö ”©—Ä”©”©–≥ –∑–æ—Ä—á–∏–∂ –¥—É—É—Å—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ –∑“Ø“Ø–Ω—ç—ç—Å –±–∞—Ä—É—É–Ω, –±–∞—Ä—É—É–Ω–∞–∞—Å –∑“Ø“Ø–Ω —à–∏–ª–∂–∏—Ö
                # –≠–Ω—ç —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ –º–∞—Ç—Ä–∏—Ü —Ö—ç–ª–±—ç—Ä—Ç—ç–π –≥—ç–∂ “Ø–∑—ç—ç–¥ —ç—Å—Ä—ç–≥ —á–∏–≥–ª—ç–ª–¥ —à–∏–ª–∂–∏—Ö
                if hasattr(self, 'moving_right') and not self.moving_right:
                    if self.current_room > 0:
                        self.current_room -= 1
                        return True
                    else:
                        self.moving_right = True
                        self.current_room += 1
                        return True
                else:
                    if self.current_room < self.n_rooms - 1:
                        self.current_room += 1
                        return True
                    else:
                        self.moving_right = False
                        self.current_room -= 1
                        return True
                        
    def _process_room(self, room_index):
        """”®—Ä”©”©–Ω–¥ –æ—Ä–∂ –∏—Ä—ç—ç–¥ —Ç“Ø“Ø–Ω–∏–π –æ–Ω—Ü–ª–æ–≥–æ–æ—Å —Ö–∞–º–∞–∞—Ä–∞–Ω “Ø–π–ª–¥—ç–ª —Ö–∏–π—Ö"""
        feature = self.room_features[room_index]
        print(f"\n[{self.moves}] ”®—Ä”©”© {room_index+1}/{self.n_rooms}: '{feature}' –æ–Ω—Ü–ª–æ–≥—Ç–æ–π")
        
        # –•–æ–æ—Å–æ–Ω ”©—Ä”©”© –¥–∞—Ä–∞–∞–ª–ª–∞–≤–∞–ª –∞–º—å –∞–ª–¥–∞—Ö
        if feature == 'empty':
            if room_index in self.visited_rooms and len(self.visited_rooms) > 1 and self.visited_rooms[-2] == room_index:
                print("  ‚ö†Ô∏è  –•–æ–æ—Å–æ–Ω ”©—Ä”©”©–≥ –¥–∞—Ä–∞–∞–ª–∞–Ω –æ—Ä–ª–æ–æ! –ê–º—å –∞–ª–¥–ª–∞–∞.")
                self.current_lives -= 1
                return
        
        # ”®—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—Ç —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–π–ª–¥–ª“Ø“Ø–¥
        if feature == 'food':
            print("  üçñ –•–æ–æ–ª –∏–¥–ª—ç—ç. –û–¥–æ–æ –∏–¥—Å—ç–Ω –±–∞–π–Ω–∞.")
            self.has_eaten = True
            
        elif feature == 'bed':
            if self.has_eaten:
                print("  üõèÔ∏è  –£–Ω—Ç–ª–∞–∞. –°—ç—Ä–ª—ç—ç.")
                self.has_eaten = False  # –£–Ω—Ç–∞–∞–¥ —Å—ç—Ä—Å—ç–Ω –±–æ–ª —Ö–æ–æ–ª –∏–¥—ç—ç–≥“Ø–π –≥—ç–∂ “Ø–∑–Ω—ç
            else:
                print("  ‚ò†Ô∏è  –ò–¥—ç—ç–≥“Ø–π –±–∞–π—Ö–∞–¥ —É–Ω—Ç–ª–∞–∞. –ê–º—å –∞–ª–¥–ª–∞–∞.")
                self.current_lives -= 1
                
        elif feature == 'toy':
            if not self.has_eaten:
                print("  ‚ò†Ô∏è  –ò–¥—ç—ç–≥“Ø–π –±–∞–π—Ö–∞–¥ —Ç–æ–≥–ª–æ–≤. –ê–º—å –∞–ª–¥–ª–∞–∞.")
                self.current_lives -= 1
            else:
                print("  üéæ –¢–æ–≥–ª–æ–≤. –•”©–≥–∂–∏–ª—Ç—ç–π –±–∞–π–Ω–∞.")
                
        elif feature == 'empty':
            print("  ‚¨ú –•–æ–æ—Å–æ–Ω ”©—Ä”©”©. –Æ—É —á –±–∞–π—Ö–≥“Ø–π.")
            
        # ”®—Ä”©”©–Ω–¥ –∑–æ—Ä—á–∏—Ö —Ç“Ø“Ø—Ö—ç–¥ –Ω—ç–º—ç—Ö
        if room_index not in self.visited_rooms:
            self.visited_rooms.append(room_index)
            
    def display_status(self):
        """–¢–æ–≥–ª–æ–æ–º—ã–Ω –æ–¥–æ–æ–≥–∏–π–Ω —Ç”©–ª–≤–∏–π–≥ —Ö–∞—Ä—É—É–ª–∞—Ö"""
        print(f"\n{'='*60}")
        print(f"–ù–û–•–û–ô–ù–´ –¢”®–õ”®–í: {self.current_lives}/{self.k_lives} –∞–º—å—Ç–∞–π")
        print(f"–û–¥–æ–æ–≥–∏–π–Ω –±–∞–π—Ä–ª–∞–ª: {self.current_room+1} –¥–∞—Ö—å ”©—Ä”©”©")
        print(f"–ò–¥—Å—ç–Ω —ç—Å—ç—Ö: {'–¢–∏–π–º' if self.has_eaten else '“Æ–≥“Ø–π'}")
        print(f"”®—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—É—É–¥: {self.room_features}")
        print(f"{'='*60}")
        
    def play(self):
        """–¢–æ–≥–ª–æ–æ–º—ã–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö"""
        print("="*60)
        print("–ù–û–•–û–ô –¢–≠–ñ–≠–≠–• –¢–û–ì–õ–û–û–ú –≠–•–≠–õ–õ–≠–≠")
        print("="*60)
        print(f"”®—Ä”©”©–Ω–∏–π —Ç–æ–æ: {self.n_rooms}")
        print(f"–ù–æ—Ö–æ–π–Ω—ã –∞–º—å: {self.k_lives}")
        print("”®—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—É—É–¥: ", self.room_features)
        print("\n–î“Ø—Ä—ç–º:")
        print("1. –ò–¥—Å—ç–Ω–∏–π –¥–∞—Ä–∞–∞ —É–Ω—Ç–∞–∂ –±–æ–ª–æ—Ö–≥“Ø–π - “Ø—Ö–Ω—ç")
        print("2. –ò–¥—ç—ç–≥“Ø–π –±–∞–π—Ö–¥–∞–∞ —Ç–æ–≥–ª–æ–∂ –±–æ–ª–æ—Ö–≥“Ø–π - “Ø—Ö–Ω—ç")
        print("3. –•–æ–æ—Å–æ–Ω ”©—Ä”©”©–≥ –¥–∞—Ä–∞–∞–ª–ª–∞–≤–∞–ª - “Ø—Ö–Ω—ç")
        print("="*60)
        
        # –ú–∞—Ç—Ä–∏—Ü —Ö—ç–ª–±—ç—Ä—Ç—ç–π —à–∏–ª–∂–∏—Ö—ç–¥ –∑–æ—Ä–∏—É–ª—Å–∞–Ω —Ö—É–≤—å—Å–∞–≥—á
        self.moving_right = True
        
        # –¢–æ–≥–ª–æ–æ–º—ã–Ω –≥–æ–ª –¥–∞–≤—Ç–∞–ª—Ç
        while self.current_lives > 0:
            self.moves += 1
            self.display_status()
            
            # ”®—Ä”©”©–Ω–¥ –æ—Ä–∂ –∏—Ä—ç—Ö
            self._process_room(self.current_room)
            
            # –ê–º—å –¥—É—É—Å—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
            if self.current_lives <= 0:
                print(f"\n{'‚ò†Ô∏è'*20}")
                print("–ù–û–•–û–ô “Æ–•–õ–≠–≠! –¢–û–ì–õ–û–û–ú –î–£–£–°–°–ê–ù!")
                print(f"{'‚ò†Ô∏è'*20}")
                break
                
            # –î–∞—Ä–∞–∞–≥–∏–π–Ω ”©—Ä”©”© —Ä“Ø“Ø —à–∏–ª–∂–∏—Ö
            print(f"\n–î–∞—Ä–∞–∞–≥–∏–π–Ω ”©—Ä”©”© —Ä“Ø“Ø —à–∏–ª–∂–∏–∂ –±–∞–π–Ω–∞...")
            time.sleep(1.5)
            
            if not self._move_to_next_room():
                print("”®—Ä”©”©–Ω“Ø“Ø–¥–∏–π–Ω —Ö–æ–æ—Ä–æ–Ω–¥ —à–∏–ª–∂–∏—Ö –±–æ–ª–æ–º–∂–≥“Ø–π –±–∞–π–Ω–∞.")
                break
                
        # –¢–æ–≥–ª–æ–æ–º—ã–Ω —Ç”©–≥—Å–≥”©–ª–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª
        self._show_game_summary()
        
    def _show_game_summary(self):
        """–¢–æ–≥–ª–æ–æ–º—ã–Ω —Ç”©–≥—Å–≥”©–ª–∏–π–Ω –¥“Ø–Ω–≥ —Ö–∞—Ä—É—É–ª–∞—Ö"""
        print("\n" + "="*60)
        print("–¢–û–ì–õ–û–û–ú–´–ù –î“Æ–ù")
        print("="*60)
        print(f"”®—Ä”©”©–Ω–∏–π —Ç–æ–æ: {self.n_rooms}")
        print(f"–≠—Ö–Ω–∏–π –∞–º—å: {self.k_likes}")
        print(f"“Æ–ª–¥—Å—ç–Ω –∞–º—å: {max(0, self.current_lives)}")
        print(f"–•–∏–π—Å—ç–Ω –∞–ª—Ö–∞–º—É—É–¥: {self.moves}")
        print(f"–ó–æ—Ä—å—Å–æ–Ω ”©—Ä”©”©–Ω“Ø“Ø–¥: {len(set(self.visited_rooms))}/{self.n_rooms}")
        
        if self.current_lives > 0:
            print(f"\nüéâ –ê–ú–ñ–ò–õ–¢–¢–ê–ô! –ù–æ—Ö–æ–π –∞–º—å–¥ “Ø–ª–¥–ª—ç—ç!")
        else:
            print(f"\n‚ò†Ô∏è –•–û–•–ò–†–û–õ! –ù–æ—Ö–æ–π “Ø—Ö–ª—ç—ç.")
            
        # ”®—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—É—É–¥—ã–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫
        feature_count = {}
        for feature in self.room_features:
            feature_count[feature] = feature_count.get(feature, 0) + 1
            
        print(f"\n”®—Ä”©”©–Ω–∏–π –æ–Ω—Ü–ª–æ–≥—É—É–¥—ã–Ω —Ç–∞—Ä—Ö–∞–ª—Ç:")
        for feature, count in feature_count.items():
            print(f"  {feature}: {count} ”©—Ä”©”©")


def main():
    """“Æ–Ω–¥—Å—ç–Ω –ø—Ä–æ–≥—Ä–∞–º"""
    print("–ù–û–•–û–ô –¢–≠–ñ–≠–≠–• –ê–ì–ï–ù–¢ - –¢–û–ì–õ–û–û–ú")
    print("="*50)
    
    # –¢–æ–≥–ª–æ–≥—á —Ç–æ—Ö–∏—Ä–≥–æ–æ–≥ –æ—Ä—É—É–ª–∞—Ö
    while True:
        try:
            n_rooms = int(input("”®—Ä”©”©–Ω–∏–π —Ç–æ–æ–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É (5-20): "))
            if 5 <= n_rooms <= 20:
                break
            else:
                print("5-20-—ã–Ω —Ö–æ–æ—Ä–æ–Ω–¥ —Ç–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É.")
        except ValueError:
            print("–¢–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É.")
            
    while True:
        try:
            k_lives = int(input("–ù–æ—Ö–æ–π–Ω—ã –∞–º—å (3-10): "))
            if 3 <= k_lives <= 10:
                break
            else:
                print("3-10-—ã–Ω —Ö–æ–æ—Ä–æ–Ω–¥ —Ç–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É.")
        except ValueError:
            print("–¢–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É.")
    
    # –¢–æ–≥–ª–æ–æ–º—ã–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö
    game = DogAgent(n_rooms, k_lives)
    game.play()
    
    # –î–∞—Ö–∏–Ω —Ç–æ–≥–ª–æ—Ö —ç—Å—ç—Ö–∏–π–≥ –∞—Å—É—É—Ö
    while True:
        play_again = input("\n–î–∞—Ö–∏–Ω —Ç–æ–≥–ª–æ—Ö —É—É? (–¢/“Æ): ").strip().lower()
        if play_again in ['—Ç', 'y', 'yes']:
            main()
            break
        elif play_again in ['“Ø', 'n', 'no']:
            print("–¢–æ–≥–ª–æ–æ–º –¥—É—É—Å–ª–∞–∞. –ë–∞—è—Ä—Ç–∞–π!")
            break
        else:
            print("'–¢' —ç—Å–≤—ç–ª '“Æ' –≥—ç–∂ –æ—Ä—É—É–ª–Ω–∞ —É—É.")


if __name__ == "__main__":
    main()
